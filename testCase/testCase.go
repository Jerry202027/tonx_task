package testcase

import (
	"fmt"
	"log"
	"time"
	"tonx_task/database"
	"tonx_task/model"
)

func InsertSampleFlights() error {
	db := database.GetDB()
	if db == nil {
		return fmt.Errorf("db not initialized")
	}

	// 30 cases for testing
	sampleFlights := []model.Flight{
		{
			FlightNo:             "BR101",
			Origin:               "TPE",
			Destination:          "HND",
			FlightDate:           time.Date(2025, 2, 10, 0, 0, 0, 0, time.UTC),
			DepartureTime:        time.Date(2025, 2, 10, 8, 20, 0, 0, time.UTC),
			ArrivalTime:          time.Date(2025, 2, 10, 12, 20, 0, 0, time.UTC),
			Price:                300.0,
			Capacity:             200,
			OverbookingThreshold: 5,
			Version:              1,
			RemainingSeats:       200 + 5,
		},
		{
			FlightNo:             "BR102",
			Origin:               "TPE",
			Destination:          "KIX",
			FlightDate:           time.Date(2025, 2, 10, 0, 0, 0, 0, time.UTC),
			DepartureTime:        time.Date(2025, 2, 10, 10, 30, 0, 0, time.UTC),
			ArrivalTime:          time.Date(2025, 2, 10, 13, 45, 0, 0, time.UTC),
			Price:                250.0,
			Capacity:             180,
			OverbookingThreshold: 3,
			Version:              1,
			RemainingSeats:       180 + 3,
		},
		{
			FlightNo:             "CI201",
			Origin:               "HND",
			Destination:          "TPE",
			FlightDate:           time.Date(2025, 2, 11, 0, 0, 0, 0, time.UTC),
			DepartureTime:        time.Date(2025, 2, 11, 7, 0, 0, 0, time.UTC),
			ArrivalTime:          time.Date(2025, 2, 11, 10, 0, 0, 0, time.UTC),
			Price:                320.0,
			Capacity:             220,
			OverbookingThreshold: 8,
			Version:              1,
			RemainingSeats:       220 + 8,
		},
		{
			FlightNo:             "CI202",
			Origin:               "KIX",
			Destination:          "TPE",
			FlightDate:           time.Date(2025, 2, 11, 0, 0, 0, 0, time.UTC),
			DepartureTime:        time.Date(2025, 2, 11, 9, 0, 0, 0, time.UTC),
			ArrivalTime:          time.Date(2025, 2, 11, 12, 20, 0, 0, time.UTC),
			Price:                280.0,
			Capacity:             200,
			OverbookingThreshold: 4,
			Version:              1,
			RemainingSeats:       200 + 4,
		},
		{
			FlightNo:             "BR103",
			Origin:               "TPE",
			Destination:          "SFO",
			FlightDate:           time.Date(2025, 2, 12, 0, 0, 0, 0, time.UTC),
			DepartureTime:        time.Date(2025, 2, 12, 22, 0, 0, 0, time.UTC),
			ArrivalTime:          time.Date(2025, 2, 13, 15, 0, 0, 0, time.UTC), // ~17 hrs later
			Price:                1100.0,
			Capacity:             300,
			OverbookingThreshold: 10,
			Version:              1,
			RemainingSeats:       300 + 10,
		},
		{
			FlightNo:             "BR104",
			Origin:               "SFO",
			Destination:          "TPE",
			FlightDate:           time.Date(2025, 2, 14, 0, 0, 0, 0, time.UTC),
			DepartureTime:        time.Date(2025, 2, 14, 14, 0, 0, 0, time.UTC),
			ArrivalTime:          time.Date(2025, 2, 15, 19, 0, 0, 0, time.UTC), // ~29 hrs total
			Price:                1200.0,
			Capacity:             280,
			OverbookingThreshold: 5,
			Version:              1,
			RemainingSeats:       280 + 5,
		},
		{
			FlightNo:             "CI203",
			Origin:               "HND",
			Destination:          "SFO",
			FlightDate:           time.Date(2025, 2, 15, 0, 0, 0, 0, time.UTC),
			DepartureTime:        time.Date(2025, 2, 15, 13, 30, 0, 0, time.UTC),
			ArrivalTime:          time.Date(2025, 2, 16, 22, 30, 0, 0, time.UTC), // ~33 hrs
			Price:                1300.0,
			Capacity:             250,
			OverbookingThreshold: 6,
			Version:              1,
			RemainingSeats:       250 + 6,
		},
		{
			FlightNo:             "BR105",
			Origin:               "TPE",
			Destination:          "LAX",
			FlightDate:           time.Date(2025, 2, 15, 0, 0, 0, 0, time.UTC),
			DepartureTime:        time.Date(2025, 2, 15, 23, 0, 0, 0, time.UTC),
			ArrivalTime:          time.Date(2025, 2, 16, 16, 30, 0, 0, time.UTC), // +17.5 hrs
			Price:                1050.0,
			Capacity:             320,
			OverbookingThreshold: 12,
			Version:              1,
			RemainingSeats:       320 + 12,
		},
		{
			FlightNo:             "BR106",
			Origin:               "LAX",
			Destination:          "TPE",
			FlightDate:           time.Date(2025, 2, 17, 0, 0, 0, 0, time.UTC),
			DepartureTime:        time.Date(2025, 2, 17, 12, 0, 0, 0, time.UTC),
			ArrivalTime:          time.Date(2025, 2, 18, 18, 0, 0, 0, time.UTC), // ~30 hrs
			Price:                1150.0,
			Capacity:             310,
			OverbookingThreshold: 8,
			Version:              1,
			RemainingSeats:       310 + 8,
		},
		{
			FlightNo:             "BR107",
			Origin:               "TPE",
			Destination:          "HND",
			FlightDate:           time.Date(2025, 2, 18, 0, 0, 0, 0, time.UTC),
			DepartureTime:        time.Date(2025, 2, 18, 9, 0, 0, 0, time.UTC),
			ArrivalTime:          time.Date(2025, 2, 18, 13, 0, 0, 0, time.UTC),
			Price:                340.0,
			Capacity:             200,
			OverbookingThreshold: 5,
			Version:              1,
			RemainingSeats:       200 + 5,
		},
		{
			FlightNo:             "BR108",
			Origin:               "KIX",
			Destination:          "TPE",
			FlightDate:           time.Date(2025, 2, 18, 0, 0, 0, 0, time.UTC),
			DepartureTime:        time.Date(2025, 2, 18, 11, 30, 0, 0, time.UTC),
			ArrivalTime:          time.Date(2025, 2, 18, 14, 45, 0, 0, time.UTC),
			Price:                280.0,
			Capacity:             180,
			OverbookingThreshold: 4,
			Version:              1,
			RemainingSeats:       180 + 4,
		},
		{
			FlightNo:             "CI204",
			Origin:               "TPE",
			Destination:          "HND",
			FlightDate:           time.Date(2025, 2, 19, 0, 0, 0, 0, time.UTC),
			DepartureTime:        time.Date(2025, 2, 19, 7, 10, 0, 0, time.UTC),
			ArrivalTime:          time.Date(2025, 2, 19, 11, 10, 0, 0, time.UTC),
			Price:                320.0,
			Capacity:             210,
			OverbookingThreshold: 7,
			Version:              1,
			RemainingSeats:       210 + 7,
		},
		{
			FlightNo:             "CI205",
			Origin:               "SFO",
			Destination:          "TPE",
			FlightDate:           time.Date(2025, 2, 20, 0, 0, 0, 0, time.UTC),
			DepartureTime:        time.Date(2025, 2, 20, 15, 0, 0, 0, time.UTC),
			ArrivalTime:          time.Date(2025, 2, 21, 19, 0, 0, 0, time.UTC),
			Price:                1200.0,
			Capacity:             300,
			OverbookingThreshold: 6,
			Version:              1,
			RemainingSeats:       300 + 6,
		},
		{
			FlightNo:             "CI206",
			Origin:               "TPE",
			Destination:          "SFO",
			FlightDate:           time.Date(2025, 2, 21, 0, 0, 0, 0, time.UTC),
			DepartureTime:        time.Date(2025, 2, 21, 23, 30, 0, 0, time.UTC),
			ArrivalTime:          time.Date(2025, 2, 22, 15, 30, 0, 0, time.UTC),
			Price:                1100.0,
			Capacity:             300,
			OverbookingThreshold: 5,
			Version:              1,
			RemainingSeats:       300 + 5,
		},
		{
			FlightNo:             "BR109",
			Origin:               "TPE",
			Destination:          "KIX",
			FlightDate:           time.Date(2025, 2, 22, 0, 0, 0, 0, time.UTC),
			DepartureTime:        time.Date(2025, 2, 22, 10, 0, 0, 0, time.UTC),
			ArrivalTime:          time.Date(2025, 2, 22, 13, 0, 0, 0, time.UTC),
			Price:                270.0,
			Capacity:             160,
			OverbookingThreshold: 4,
			Version:              1,
			RemainingSeats:       160 + 4,
		},
		{
			FlightNo:             "BR110",
			Origin:               "KIX",
			Destination:          "TPE",
			FlightDate:           time.Date(2025, 2, 23, 0, 0, 0, 0, time.UTC),
			DepartureTime:        time.Date(2025, 2, 23, 11, 30, 0, 0, time.UTC),
			ArrivalTime:          time.Date(2025, 2, 23, 14, 30, 0, 0, time.UTC),
			Price:                280.0,
			Capacity:             180,
			OverbookingThreshold: 4,
			Version:              1,
			RemainingSeats:       180 + 4,
		},
		{
			FlightNo:             "BR111",
			Origin:               "TPE",
			Destination:          "LAX",
			FlightDate:           time.Date(2025, 2, 24, 0, 0, 0, 0, time.UTC),
			DepartureTime:        time.Date(2025, 2, 24, 22, 0, 0, 0, time.UTC),
			ArrivalTime:          time.Date(2025, 2, 25, 15, 0, 0, 0, time.UTC),
			Price:                1080.0,
			Capacity:             320,
			OverbookingThreshold: 8,
			Version:              1,
			RemainingSeats:       320 + 8,
		},
		{
			FlightNo:             "BR112",
			Origin:               "LAX",
			Destination:          "TPE",
			FlightDate:           time.Date(2025, 2, 26, 0, 0, 0, 0, time.UTC),
			DepartureTime:        time.Date(2025, 2, 26, 12, 0, 0, 0, time.UTC),
			ArrivalTime:          time.Date(2025, 2, 27, 18, 30, 0, 0, time.UTC),
			Price:                1160.0,
			Capacity:             300,
			OverbookingThreshold: 5,
			Version:              1,
			RemainingSeats:       300 + 5,
		},
		{
			FlightNo:             "BR113",
			Origin:               "TPE",
			Destination:          "HND",
			FlightDate:           time.Date(2025, 2, 27, 0, 0, 0, 0, time.UTC),
			DepartureTime:        time.Date(2025, 2, 27, 6, 55, 0, 0, time.UTC),
			ArrivalTime:          time.Date(2025, 2, 27, 10, 55, 0, 0, time.UTC),
			Price:                330.0,
			Capacity:             200,
			OverbookingThreshold: 3,
			Version:              1,
			RemainingSeats:       200 + 3,
		},
		{
			FlightNo:             "BR114",
			Origin:               "HND",
			Destination:          "TPE",
			FlightDate:           time.Date(2025, 2, 27, 0, 0, 0, 0, time.UTC),
			DepartureTime:        time.Date(2025, 2, 27, 12, 10, 0, 0, time.UTC),
			ArrivalTime:          time.Date(2025, 2, 27, 15, 10, 0, 0, time.UTC),
			Price:                310.0,
			Capacity:             220,
			OverbookingThreshold: 7,
			Version:              1,
			RemainingSeats:       220 + 7,
		},
		{
			FlightNo:             "CI207",
			Origin:               "TPE",
			Destination:          "KIX",
			FlightDate:           time.Date(2025, 2, 28, 0, 0, 0, 0, time.UTC),
			DepartureTime:        time.Date(2025, 2, 28, 9, 30, 0, 0, time.UTC),
			ArrivalTime:          time.Date(2025, 2, 28, 12, 30, 0, 0, time.UTC),
			Price:                260.0,
			Capacity:             180,
			OverbookingThreshold: 5,
			Version:              1,
			RemainingSeats:       180 + 5,
		},
		{
			FlightNo:             "CI208",
			Origin:               "KIX",
			Destination:          "TPE",
			FlightDate:           time.Date(2025, 2, 28, 0, 0, 0, 0, time.UTC),
			DepartureTime:        time.Date(2025, 2, 28, 14, 30, 0, 0, time.UTC),
			ArrivalTime:          time.Date(2025, 2, 28, 17, 30, 0, 0, time.UTC),
			Price:                280.0,
			Capacity:             180,
			OverbookingThreshold: 3,
			Version:              1,
			RemainingSeats:       180 + 3,
		},
		{
			FlightNo:             "BR115",
			Origin:               "SFO",
			Destination:          "TPE",
			FlightDate:           time.Date(2025, 3, 1, 0, 0, 0, 0, time.UTC),
			DepartureTime:        time.Date(2025, 3, 1, 15, 0, 0, 0, time.UTC),
			ArrivalTime:          time.Date(2025, 3, 2, 19, 0, 0, 0, time.UTC),
			Price:                1250.0,
			Capacity:             290,
			OverbookingThreshold: 7,
			Version:              1,
			RemainingSeats:       290 + 7,
		},
		{
			FlightNo:             "BR116",
			Origin:               "TPE",
			Destination:          "SFO",
			FlightDate:           time.Date(2025, 3, 3, 0, 0, 0, 0, time.UTC),
			DepartureTime:        time.Date(2025, 3, 3, 22, 10, 0, 0, time.UTC),
			ArrivalTime:          time.Date(2025, 3, 4, 15, 10, 0, 0, time.UTC),
			Price:                1150.0,
			Capacity:             300,
			OverbookingThreshold: 8,
			Version:              1,
			RemainingSeats:       300 + 8,
		},
		{
			FlightNo:             "CI209",
			Origin:               "LAX",
			Destination:          "TPE",
			FlightDate:           time.Date(2025, 3, 5, 0, 0, 0, 0, time.UTC),
			DepartureTime:        time.Date(2025, 3, 5, 12, 50, 0, 0, time.UTC),
			ArrivalTime:          time.Date(2025, 3, 6, 18, 50, 0, 0, time.UTC),
			Price:                1180.0,
			Capacity:             320,
			OverbookingThreshold: 10,
			Version:              1,
			RemainingSeats:       320 + 10,
		},
		{
			FlightNo:             "BR120",
			Origin:               "SFO",
			Destination:          "TPE",
			FlightDate:           time.Date(2025, 3, 11, 0, 0, 0, 0, time.UTC),
			DepartureTime:        time.Date(2025, 3, 11, 14, 0, 0, 0, time.UTC),
			ArrivalTime:          time.Date(2025, 3, 12, 19, 30, 0, 0, time.UTC),
			Price:                1300.0,
			Capacity:             290,
			OverbookingThreshold: 5,
			Version:              1,
			RemainingSeats:       290 + 5,
		},
		// New additional records to reach 30 flights:
		{
			FlightNo:             "BR117",
			Origin:               "TPE",
			Destination:          "LAX",
			FlightDate:           time.Date(2025, 3, 1, 0, 0, 0, 0, time.UTC),
			DepartureTime:        time.Date(2025, 3, 1, 20, 0, 0, 0, time.UTC),
			ArrivalTime:          time.Date(2025, 3, 2, 4, 0, 0, 0, time.UTC),
			Price:                1100.0,
			Capacity:             310,
			OverbookingThreshold: 10,
			Version:              1,
			RemainingSeats:       310 + 10,
		},
		{
			FlightNo:             "BR118",
			Origin:               "LAX",
			Destination:          "TPE",
			FlightDate:           time.Date(2025, 3, 2, 0, 0, 0, 0, time.UTC),
			DepartureTime:        time.Date(2025, 3, 2, 12, 0, 0, 0, time.UTC),
			ArrivalTime:          time.Date(2025, 3, 2, 22, 0, 0, 0, time.UTC),
			Price:                1120.0,
			Capacity:             300,
			OverbookingThreshold: 8,
			Version:              1,
			RemainingSeats:       300 + 8,
		},
		{
			FlightNo:             "BR119",
			Origin:               "TPE",
			Destination:          "HND",
			FlightDate:           time.Date(2025, 3, 3, 0, 0, 0, 0, time.UTC),
			DepartureTime:        time.Date(2025, 3, 3, 9, 0, 0, 0, time.UTC),
			ArrivalTime:          time.Date(2025, 3, 3, 13, 0, 0, 0, time.UTC),
			Price:                350.0,
			Capacity:             210,
			OverbookingThreshold: 5,
			Version:              1,
			RemainingSeats:       210 + 5,
		},
		{
			FlightNo:             "CI210",
			Origin:               "KIX",
			Destination:          "TPE",
			FlightDate:           time.Date(2025, 3, 4, 0, 0, 0, 0, time.UTC),
			DepartureTime:        time.Date(2025, 3, 4, 10, 0, 0, 0, time.UTC),
			ArrivalTime:          time.Date(2025, 3, 4, 13, 0, 0, 0, time.UTC),
			Price:                300.0,
			Capacity:             180,
			OverbookingThreshold: 3,
			Version:              1,
			RemainingSeats:       180 + 3,
		},
	}

	if err := db.Create(&sampleFlights).Error; err != nil {
		return fmt.Errorf("failed to insert test case flights: %v", err)
	}

	log.Printf("Inserted %d test case flights.", len(sampleFlights))
	return nil
}
